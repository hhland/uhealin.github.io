<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Eclipse开发插件 &mdash; ODPS 1.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="ODPS 1.0 documentation" href="../../index.html" />
    <link rel="up" title="ODPS工具手册" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../odps_appendix.html" title="附录"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="odps_dship.html" title="ODPS数据上传下载工具"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">ODPS 1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">ODPS工具手册</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="eclipse">
<span id="odps-tools-eclipse"></span><h1>Eclipse开发插件<a class="headerlink" href="#eclipse" title="Permalink to this headline">¶</a></h1>
<p>为了方便用户使用 <a class="reference internal" href="../odps_mr/index.html#odps-open-mr"><em>MapReduce</em></a> 及 <a class="reference internal" href="../odps_sql/odps_sql_udf.html#odps-sql-udf"><em>自定义函数(UDF)</em></a> 的SDK进行开发工作，ODPS提供了Eclipse开发插件。该插件能够模拟MapReduce及UDF的运行过程，为用户提供本地调试手段，并提供了简单的模板生成功能。</p>
<div class="section" id="id1">
<h2>插件安装<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>下载Eclipse插件后，将插件放置在Eclipse安装目录的plugins子目录下。打开Eclipse，点击右上角的打开透视图(Open Perspective)：</p>
<a class="reference internal image-reference" href="../../_images/perspective.jpg"><img alt="../../_images/perspective.jpg" class="align-center" src="../../_images/perspective.jpg" /></a>
<p>点击后出现下面的对话框：</p>
<a class="reference internal image-reference" href="../../_images/odps.jpg"><img alt="../../_images/odps.jpg" class="align-center" src="../../_images/odps.jpg" /></a>
<p>选择ODPS，随后点击OK键。同样在右上角会出现ODPS图标，表示插件生效：</p>
<a class="reference internal image-reference" href="../../_images/odps2.jpg"><img alt="../../_images/odps2.jpg" class="align-center" src="../../_images/odps2.jpg" /></a>
<p>在左上角选择文件(File) -&gt; 新建(New)-&gt; ODPS Project，创建工程(示例中使用ODPS作为工程名)：</p>
<a class="reference internal image-reference" href="../../_images/project.jpg"><img alt="../../_images/project.jpg" class="align-center" src="../../_images/project.jpg" /></a>
<p>创建ODPS工程后会出现如下对话框。输入Project name，选择ODPS客户端路径(客户端需要提前下载)，并确认(点击Finish)：</p>
<a class="reference internal image-reference" href="../../_images/project_config.jpg"><img alt="../../_images/project_config.jpg" class="align-center" src="../../_images/project_config.jpg" /></a>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">关于ODPS客户端的介绍请参考 <a class="reference internal" href="odps_cli.html#odps-console"><em>ODPS客户端参考手册</em></a> 。</p>
</div>
<p>创建好工程后，在左侧包资源管理器(Package Explorer)中可以看到如下目录结构：</p>
<a class="reference internal image-reference" href="../../_images/explorer.jpg"><img alt="../../_images/explorer.jpg" class="align-center" src="../../_images/explorer.jpg" /></a>
<p>ODPS Eclipse插件安装结束。用户可以使用此插件编写MapReduce及UDF程序。关于插件中对MapReduce及UDF的功能介绍请参考 <a class="reference internal" href="#odps-tool-eclipse-mr"><em>MapReduce开发插件介绍</em></a> 及 <a class="reference internal" href="#odps-tool-eclipse-udf"><em>UDF开发插件介绍</em></a> 。</p>
</div>
<div class="section" id="mapreduce">
<span id="odps-tool-eclipse-mr"></span><h2>MapReduce开发插件介绍<a class="headerlink" href="#mapreduce" title="Permalink to this headline">¶</a></h2>
<p>右键选择src目录，选择新建(New) -&gt; Mapper:</p>
<a class="reference internal image-reference" href="../../_images/mapper.jpg"><img alt="../../_images/mapper.jpg" class="align-center" src="../../_images/mapper.jpg" /></a>
<p>选择Mapper后出现下面的对话框。输入Package名称(可选)，Mapper类的名字，并确认：</p>
<a class="reference internal image-reference" href="../../_images/mapper_conf.jpg"><img alt="../../_images/mapper_conf.jpg" class="align-center" src="../../_images/mapper_conf.jpg" /></a>
<p>会看到在左侧包资源管理器(Package Explorer)中，src目录下生成文件MyMapper.java。该文件的内容即是一个Mapper类的模板：</p>
<a class="reference internal image-reference" href="../../_images/mapper_temp.jpg"><img alt="../../_images/mapper_temp.jpg" class="align-center" src="../../_images/mapper_temp.jpg" /></a>
<p>编写模板内容：</p>
<a class="reference internal image-reference" href="../../_images/mapper_code.jpg"><img alt="../../_images/mapper_code.jpg" class="align-center" src="../../_images/mapper_code.jpg" /></a>
<p>同理，右键选择src目录，选择新建(New) -&gt; Reduce。输入Package名称(可选)，Reduce类的名字(本示例使用MyReduce)。同样在包资源管理器(Package Explorer)中，src目录下生成文件MyReduce.java。该文件的内容即是一个Reduce类的模板。编辑模板：</p>
<a class="reference internal image-reference" href="../../_images/reduce_code.jpg"><img alt="../../_images/reduce_code.jpg" class="align-center" src="../../_images/reduce_code.jpg" /></a>
<p>创建main函数: 右键选择src目录，选择新建(New) -&gt; MapReduce Driver。填写Driver Name(示例中是MyDriver)，Mapper及Recduce类(示例中是MyMapper及MyReduce)，并确认。同样会在src目录下看到MyDriver.java文件：</p>
<a class="reference internal image-reference" href="../../_images/driver.jpg"><img alt="../../_images/driver.jpg" class="align-center" src="../../_images/driver.jpg" /></a>
<p>通常情况下，&#8221;MyDriver.java&#8221;的代码不需要进行修改，可以按照下面的步骤继续进行。在examples目录下找到LocalDriver.java文件:</p>
<a class="reference internal image-reference" href="../../_images/driver_dir.jpg"><img alt="../../_images/driver_dir.jpg" class="align-center" src="../../_images/driver_dir.jpg" /></a>
<p>选中LocalDriver.java，右键选择Run As -&gt; Run Configuration，点击确认：</p>
<a class="reference internal image-reference" href="../../_images/driver_run.jpg"><img alt="../../_images/driver_run.jpg" class="align-center" src="../../_images/driver_run.jpg" /></a>
<p>点击后，出现如下对话框，双击Java Application：</p>
<a class="reference internal image-reference" href="../../_images/driver_conf.jpg"><img alt="../../_images/driver_conf.jpg" class="align-center" src="../../_images/driver_conf.jpg" /></a>
<p>双击后，选择&#8221;(x)=Arguments&#8221;，在输入框中输入MyDriver mr_test，并确认。其中MyDriver表示上文中提到的MapReduce Driver的类名。mr_test表示本地项目空间名称，详情请参考 <a class="reference internal" href="../odps_mr/odps_mr_cmd.html#odps-mr-local"><em>本地运行MapReduce</em></a> ：</p>
<a class="reference internal image-reference" href="../../_images/driver_args.jpg"><img alt="../../_images/driver_args.jpg" class="align-center" src="../../_images/driver_args.jpg" /></a>
<p>确认后，开始本地运行MapReduce程序，如果配置正确，会看到如下提示：</p>
<a class="reference internal image-reference" href="../../_images/driver_rst.jpg"><img alt="../../_images/driver_rst.jpg" class="align-center" src="../../_images/driver_rst.jpg" /></a>
<p>有如上输出信息，说明本地运行成功。运行的输出结果在warehouse目录下。关于warehouse的说明请参考 <a class="reference internal" href="../odps_mr/odps_mr_cmd.html#odps-mr-local"><em>本地运行MapReduce</em></a> 。刷新ODPS工程：</p>
<a class="reference internal image-reference" href="../../_images/warehouse.jpg"><img alt="../../_images/warehouse.jpg" class="align-center" src="../../_images/warehouse.jpg" /></a>
<p>wc_out即是输出目录，R_000000即是结果文件。通过本地调试，确定输出结果正确后，可以通过Eclipse导出(Export)功能将MapReduce打包。打包后将jar包上传到ODPS中。在分布式环境下执行MapReduce，详情请参考 <a class="reference internal" href="../odps_mr/odps_mr_quickstart.html#odps-openmr-quickstart"><em>快速入门</em></a> 。</p>
<p>需要说明的是，wc_in及wc_out是程序的输入及输出表。这个是eclipse插件的默认配置。如果想更改这个配置，可以修改MyDriver.java的内容：</p>
<a class="reference internal image-reference" href="../../_images/driver_code.jpg"><img alt="../../_images/driver_code.jpg" class="align-center" src="../../_images/driver_code.jpg" /></a>
<p>本地调试通过后，用户可以通过Eclipse的Export功能将代码打成jar包，供后续分布式环境使用。在本示例中，我们将程序包命名为mr-examples.jar。选择src目录，点击Export：</p>
<a class="reference internal image-reference" href="../../_images/export.jpg"><img alt="../../_images/export.jpg" class="align-center" src="../../_images/export.jpg" /></a>
<p>选择导出模式为Jar File：</p>
<a class="reference internal image-reference" href="../../_images/jar_file_type.jpg"><img alt="../../_images/jar_file_type.jpg" class="align-center" src="../../_images/jar_file_type.jpg" /></a>
<p>仅需要导出src目录下package(com.aliyun.odps.mapred.open.example)，Jar File名称指定为“mr-examples.jar”：</p>
<a class="reference internal image-reference" href="../../_images/export_rst.jpg"><img alt="../../_images/export_rst.jpg" class="align-center" src="../../_images/export_rst.jpg" /></a>
<p>确认后，导出成功。</p>
<p>如果用户想在本地模拟新建Project，可以在warehouse下面，创建一个新的子目录(与mr_test平级的目录)，例如：my_new_project。如果用户想新建表，可以再Project目录下创建目录，例如：dual，并指定dual的表结构及数据，目录关系为：</p>
<div class="highlight-python"><pre>warehouse
   |______mr_test(项目空间目录)
   |          |______wc_in(表数据目录)
   |          |        |____ data(文件)
   |          |        |____ __schema__ (文件)
   |          |
   |          |______wc_in(表数据目录)
   |                   |____ data(文件)
   |                   |____ __schema__ (文件)
   |
   |______my_new_project
              |______dual
                      |___data
                      | __schema__</pre>
</div>
<p>__schema__文件示例：</p>
<div class="highlight-python"><pre>my_new_project.dual,col1:bigint,col2:string,col3:boolean,col4:double</pre>
</div>
</div>
<div class="section" id="udf">
<span id="odps-tool-eclipse-udf"></span><h2>UDF开发插件介绍<a class="headerlink" href="#udf" title="Permalink to this headline">¶</a></h2>
<p>在本章节我们将介绍如何使用Eclipse插件开发并在本地运行UDF。</p>
<p>首先，选中src文件，右键选择新建(New) –&gt; UDF：</p>
<a class="reference internal image-reference" href="../../_images/udf.jpg"><img alt="../../_images/udf.jpg" class="align-center" src="../../_images/udf.jpg" /></a>
<p>选择创建UDF后，需要输入Package名称(本示例为org.alidata.odps.udf.examples)，UDF类名(MyUDF)，点击确认：</p>
<a class="reference internal image-reference" href="../../_images/udf_conf.jpg"><img alt="../../_images/udf_conf.jpg" class="align-center" src="../../_images/udf_conf.jpg" /></a>
<p>此时会在src下生成两个Package，其中org.alidata.odps.udf.examples用于编写UDF代码，而test.org.alidata.odps.udf.examples用于模拟UDF的本地运行。打开org.alidata.odps.udf.examples下的MyUDF.java文件，其内容是Eclipse插件为用户自动创建的UDF开发模板。如果用户创建的是UDTF，则此文件的内容即是一个UDTF模板：</p>
<a class="reference internal image-reference" href="../../_images/udf_temp.jpg"><img alt="../../_images/udf_temp.jpg" class="align-center" src="../../_images/udf_temp.jpg" /></a>
<p>编辑UDF模板：</p>
<a class="reference internal image-reference" href="../../_images/udf_code.jpg"><img alt="../../_images/udf_code.jpg" class="align-center" src="../../_images/udf_code.jpg" /></a>
<p>UDF代码编写完成。为了运行这个UDF，我们还需要编写输入文件TestMyUDF.in。而TestMyUDF.out将会作为MyUDF本地运行时的输出目录：</p>
<a class="reference internal image-reference" href="../../_images/udf_input.jpg"><img alt="../../_images/udf_input.jpg" class="align-center" src="../../_images/udf_input.jpg" /></a>
<p>选中TestMyUDF.java，右键选择Run As -&gt; Java Application：</p>
<a class="reference internal image-reference" href="../../_images/udf_run.jpg"><img alt="../../_images/udf_run.jpg" class="align-center" src="../../_images/udf_run.jpg" /></a>
<p>运行成功后在屏幕下方会出现成功提示。打开输出文件TestMyUDF.out会看到输出结果：</p>
<a class="reference internal image-reference" href="../../_images/udf_out.jpg"><img alt="../../_images/udf_out.jpg" class="align-center" src="../../_images/udf_out.jpg" /></a>
<p>通过本地调试，确定输出结果正确后，可以通过Eclipse导出(Export)功能将MapReduce打包。打包后将jar包上传到ODPS中。UDF的导出过程与MapReduce导出过程类似，请注意，不需要将整个工程打包，仅需要打包UDF对应的类文件即可。</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Eclipse开发插件</a><ul>
<li><a class="reference internal" href="#id1">插件安装</a></li>
<li><a class="reference internal" href="#mapreduce">MapReduce开发插件介绍</a></li>
<li><a class="reference internal" href="#udf">UDF开发插件介绍</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../odps_appendix.html" title="附录"
             >next</a></li>
        <li class="right" >
          <a href="odps_dship.html" title="ODPS数据上传下载工具"
             >previous</a> |</li>
        <li><a href="../../index.html">ODPS 1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >ODPS工具手册</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright Alibaba 2014-07-01.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2b1.
    </div>
  <!-- 请把脚本放到 body 元素内 -->
  </body>
</html>