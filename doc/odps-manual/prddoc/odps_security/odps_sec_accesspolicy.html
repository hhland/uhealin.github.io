<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>访问策略语言 &mdash; ODPS 1.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="ODPS 1.0 documentation" href="../../index.html" />
    <link rel="up" title="ODPS 安全参考手册" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../odps_tools/index.html" title="ODPS工具手册"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="odps_sec_cmdlist.html" title="ODPS安全相关语句汇总"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">ODPS 1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">ODPS 安全参考手册</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="odps-sec-accesspolicy">
<span id="id1"></span><h1>访问策略语言<a class="headerlink" href="#odps-sec-accesspolicy" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id2">
<h2>基本术语<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>权限(Permission)是访问控制的一个基本概念，它表示允许或拒绝一个请求者(Requester)对资源(Resource)执行某种操作(Action)。我们用语句(Statement)来表示单个权限的形式化描述，而用策略(Policy)来表示语句的集合。</p>
<p>访问策略(Access Policy)主要包括如下的访问控制元素：主体(Principal)、操作(Action)、资源(Resource)、访问限制(Access Restriction)和效果(Effect)。下面分别对这几个基本实体进行简要描述。</p>
<div class="section" id="principal">
<h3>主体(Principal)<a class="headerlink" href="#principal" title="Permalink to this headline">¶</a></h3>
<p>主体(Principal)是指访问策略中的权限被指派的对象。比如，访问策略&#8221;允许张三在2011年12月31日之前对资源SampleBucket执行CreateObject操作&#8221;中的主体是&#8221;张三&#8221;。</p>
</div>
<div class="section" id="action">
<h3>操作(Action)<a class="headerlink" href="#action" title="Permalink to this headline">¶</a></h3>
<p>操作(Action)是指主体对资源的访问方法。比如，访问策略&#8221;允许张三在2011年12月31日之前对资源SampleBucket执行CreateObject操作&#8221;中的操作是&#8221;CreateObject&#8221;。</p>
</div>
<div class="section" id="resource">
<h3>资源(Resource)<a class="headerlink" href="#resource" title="Permalink to this headline">¶</a></h3>
<p>资源(Resource)是指主体请求访问的对象。比如，访问策略&#8221;允许张三在2011年12月31日之前对资源SampleBucket执行CreateObject操作&#8221;中的资源是&#8221;SampleBucket&#8221;。</p>
</div>
<div class="section" id="access-restriction">
<h3>访问限制(Access Restriction)<a class="headerlink" href="#access-restriction" title="Permalink to this headline">¶</a></h3>
<p>访问限制(Access Restriction)是指权限生效的限制条件。比如，访问策略&#8221;允许张三在2011年12月31日之前对资源SampleBucket执行CreateObject操作&#8221;中的限制条件是&#8221;在2011年12月31日之前&#8221;。</p>
</div>
<div class="section" id="effect">
<h3>效力(Effect)<a class="headerlink" href="#effect" title="Permalink to this headline">¶</a></h3>
<p>授权效力包括两个方面：允许操作（Allow）和拒绝操作（Deny）。通常，Deny有更高的效力，在权限检查时会优先使用。注意，拒绝操作和&#8221;撤销授权&#8221;是完全独立的两个概念，撤销授权通常包括撤销对Allow和Deny这两种不同效力的授权，比如传统数据库一般支持Revoke和Revoke Deny两种操作。</p>
</div>
</div>
<div class="section" id="id3">
<h2>访问策略语言结构<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>下图描述了访问策略的基本结构。一个策略(Policy)由以下部分组成：(1) 可选的策略头部元素；(2) 一条或多条语句(Statement)。策略头部元素是可选的，它主要包括策略的版本信息。策略的主体是语句的集合。</p>
<div class="highlight-python"><pre>Policy结构：
+---------------------------------+
|                                 |
| +-----------------------------+ |
| | Optional top-level elements | |
| +-----------------------------+ |
|            +-----------+        |
|            | Statement |        |
|            +-----------+        |
|                                 |
|            +-----------+        |
|            | Statement |        |
|            +-----------+        |
|                                 |
|            +-----------+        |
|            | Statement |        |
|            +-----------+        |
|                                 |
+---------------------------------+

Statement结构：
 +-----------------+
 | Effect          |
 +-----------------+
 | Principal       |
 +-----------------+
 | Action          |
 +-----------------+
 | Resource        |
 +-----------------+
 | Condition Block |
 +-----------------+</pre>
</div>
<div class="section" id="statement">
<h3>授权语句(Statement)结构<a class="headerlink" href="#statement" title="Permalink to this headline">¶</a></h3>
<p>一条授权语句(Statement)包括如下条目：</p>
<ul class="simple">
<li>Effect: 指明该条语句的权限类型，取值必须为Allow或Deny。</li>
<li>Principal: 如果Policy在授权时是与用户或角色绑定，那么就不允许再指定Principal，比如ODPS的Role Policy。如果Policy在授权时是与项目空间或项目空间内的对象绑定，那么必须指定Principal，比如ODPS的Project Policy。</li>
<li>Action: 它表示授权操作，可以是一个或多个操作名，可支持通配符号&#8221;*&#8221;和&#8221;?&#8221;。例如，Action = &#8220;*&#8221; 表示所有的操作。</li>
<li>Resource: 它表示授权对象，可以是一个或多个对象名，可支持通配符号&#8221;*&#8221;和&#8221;?&#8221;。例如Resource = &#8220;*&#8221; 表示所有的对象。</li>
<li>Condition Block: 条件块是该条授权语句所述权限得以生效的条件。条件块结构请参见下节的描述。</li>
</ul>
</div>
<div class="section" id="odps-sec-accesspolicy-condition">
<span id="id4"></span><h3>条件块结构<a class="headerlink" href="#odps-sec-accesspolicy-condition" title="Permalink to this headline">¶</a></h3>
<p>条件块由一个或多个条件子句构成。一个条件子句由条件操作类型、条件关键字和条件值组成。条件操作类型和条件关键字在下文中会有详细描述。</p>
<p>条件块的满足性判断原则如下图所示。描述如下：(1) 一个条件关键字可以指定一个或多个值，在条件检查时，如果条件关键字的值与指定值中的某一个相等，即可判定条件满足。(2) 同一种条件操作类型的条件子句下的多个条件关键字同时满足的情况下，才能判定该条件子句满足。(3) 条件块下的所有条件子句同时满足的情况下，才能判定该条件块满足。</p>
<div class="highlight-python"><pre>条件块判断逻辑

    +----------------------------------------+
    | Condition 1:                           |
 +--|    key1: value1a OR value1b OR value1c |
 |  | AND                                    |
 |  |    key2: value2a OR value2b            |
 |  +----------------------------------------+
AND
 |  +----------------------------------------+
 |  | Condition 2:                           |
 +--|    key3: value3                        |
    +----------------------------------------+</pre>
</div>
</div>
<div class="section" id="id5">
<h3>条件操作类型<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>我们支持如下条件操作类型：字符串类型、数字类型、日期类型、布尔类型和IP地址类型。每种条件操作类型分别支持如下的方法：</p>
<dl class="docutils">
<dt>String</dt>
<dd><ul class="first last simple">
<li>StringEquals</li>
<li>StringNotEquals</li>
<li>StringEqualsIgnoreCase</li>
<li>StringNotEqualsIgnoreCase</li>
<li>StringLike</li>
<li>StringNotLike</li>
</ul>
</dd>
<dt>Numeric</dt>
<dd><ul class="first last simple">
<li>NumericEquals</li>
<li>NumericEquals</li>
<li>NumericLessThan</li>
<li>NumericLessThanEquals</li>
<li>NumericGreaterThan</li>
<li>NumericGreaterThanEquals</li>
</ul>
</dd>
<dt>Date and time</dt>
<dd><ul class="first last simple">
<li>DateEquals</li>
<li>DateNotEquals</li>
<li>DateLessThan</li>
<li>DateLessThanEquals</li>
<li>DateGreaterThan</li>
<li>DateGreaterThanEquals</li>
</ul>
</dd>
<dt>Boolean</dt>
<dd><ul class="first last simple">
<li>Bool</li>
</ul>
</dd>
<dt>IP address</dt>
<dd><ul class="first last simple">
<li>IpAddress</li>
<li>NotIpAddress</li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="id6">
<h3>条件关键字<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>首先，ODPS支持开放云服务ACS (Aliyun Cloud Service) 保留的如下条件关键字：</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="14%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">ACS保留条件关键字</th>
<th class="head">类型</th>
<th class="head">说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>acs:CurrentTime</td>
<td>Date and time</td>
<td>Web Server接收到请求的时间，以ISO 8601格式表示，如2012-11-11T23:59:59Z</td>
</tr>
<tr class="row-odd"><td>acs:SecureTransport</td>
<td>Boolean</td>
<td>发送请求是否使用了安全信道，如HTTPS</td>
</tr>
<tr class="row-even"><td>acs:SourceIp</td>
<td>IP address</td>
<td>发送请求时的客户端IP地址</td>
</tr>
<tr class="row-odd"><td>acs:UserAgent</td>
<td>String</td>
<td>发送请求时的客户端UserAgent</td>
</tr>
<tr class="row-even"><td>acs:Referer</td>
<td>String</td>
<td>发送请求时的HTTP referer</td>
</tr>
</tbody>
</table>
<p>此外，ODPS新增了如下的条件关键字：</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="11%" />
<col width="70%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">ODPS扩展条件关键字</th>
<th class="head">类型</th>
<th class="head">说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>odps:TaskType</td>
<td>String</td>
<td>ODPS任务类型。目前支持的任务类型有：SQL, MR, DT</td>
</tr>
<tr class="row-odd"><td>dt:SourceType</td>
<td>String</td>
<td>ODPS DT Task 数据源类型。目前支持的数据源类型有：odps, file, oracle, mysql</td>
</tr>
<tr class="row-even"><td>dt:SourceIp</td>
<td>IP address</td>
<td>ODPS DT Task 数据源IP地址</td>
</tr>
<tr class="row-odd"><td>dt:SourceResource</td>
<td>String</td>
<td>ODPS DT Task 数据源对象，参考 Resource命名规范</td>
</tr>
<tr class="row-even"><td>dt:TargetType</td>
<td>String</td>
<td>ODPS DT Task 目标类型。目前支持的目标类型有：odps, file, oracle, mysql</td>
</tr>
<tr class="row-odd"><td>dt:TargetIp</td>
<td>IP address</td>
<td>ODPS DT Task 目标IP地址</td>
</tr>
<tr class="row-even"><td>dt:TargetResource</td>
<td>String</td>
<td>ODPS DT Task 目标对象，参考 Resource命名规范</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>acs:SourceIp是指http connection的remote_ip，而不是http header中的 &#8220;x-forwarded-for&#8221; 所指的ip list中的ip。举例来说，如果10.230.205.105是一个局域网Ip，acs:SourceIp则为该网络的网关出口Ip。如果该网络出口使用了代理服务器，那么acs:SourceIp为该代理服务器Ip；如果有多级代理服务器，则为最后一级代理服务器Ip。如果代理服务器设置的代理规则不同，那么对acs:SourceIp的值也有影响。</li>
</ul>
</div>
</div>
</div>
<div class="section" id="id7">
<h2>访问策略语言规范<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id8">
<h3>Principal命名规范<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>Principal是指请求发送者的身份。目前仅支持阿里云帐号、域账号和淘宝账号的身份表示。对于云账号，可以支持ID或DisplayName的表示。比如：</p>
<div class="highlight-python"><pre>"Principal": "43274"
"Principal": "ALIYUN$jun.li@aliyun.com"
"Principal": ["ALIYUN$jun.li@aliyun.com","ALIYUN$jack@aliyun.com", "TAOBAO$alice"]</pre>
</div>
</div>
<div class="section" id="id9">
<h3>Resource命名规范<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>我们使用如下格式来命名odps所提供的资源。格式如下：</p>
<div class="highlight-python"><pre>acs:&lt;service-name&gt;:&lt;namespace&gt;:&lt;relative-id&gt;</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>acs: 保留的Resource头部。</li>
<li>service-name: 阿里云开放服务名称，如odps, oss, ots等。</li>
<li>namespace: 命名空间，用于资源隔离。如果以云帐号ID来做资源隔离，那么可取值为云帐号ID。如果不支持该项，可以使用通配符&#8221;*&#8221;号来代替。</li>
<li>relative-id: 与service相关的资源描述部分，其语义由具体service指定。这部分的格式描述支持类似于文件路径的树状结构。以odps为例，relative-id的格式为：projects/&lt;project_name&gt;/&lt;object_type&gt;/&lt;object_name&gt;。</li>
</ul>
</div>
<p>ODPS Resource命名样例:</p>
<table border="1" class="docutils">
<colgroup>
<col width="39%" />
<col width="61%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Resource命名实例</th>
<th class="head">说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>*</td>
<td>项目空间中的所有对象</td>
</tr>
<tr class="row-odd"><td>projects/prj1/tables/t1</td>
<td>项目空间prj1中的t1表</td>
</tr>
<tr class="row-even"><td>projects/prj1/instances/*</td>
<td>项目空间prj1中的所有的instances</td>
</tr>
<tr class="row-odd"><td>projects/prj1/tables/*</td>
<td>项目空间prj1中的所有表</td>
</tr>
<tr class="row-even"><td colspan="2">projects/prj1/tables/taobao* | 项目空间prj1中的所有以 taobao 开头的表</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id10">
<h3>Action命名规范<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>Action命名规范如下：</p>
<div class="highlight-python"><pre>&lt;service-name&gt;:&lt;action-name&gt;</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>service-name: 开放服务名称，如odps, oss, ots等。</li>
<li>action-name: service相关的操作接口名称。</li>
</ul>
</div>
<p>ODPS Action命名样例:</p>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Action命名实例</th>
<th class="head">说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>*</td>
<td>所有操作</td>
</tr>
<tr class="row-odd"><td>odps:*</td>
<td>ODPS的所有操作</td>
</tr>
<tr class="row-even"><td>odps:CreateTable</td>
<td>ODPS的CreateTable操作</td>
</tr>
<tr class="row-odd"><td>odps:Create*</td>
<td>ODPS的所有以Create开头的操作</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="condition-keys">
<h3>Condition Keys命名规范<a class="headerlink" href="#condition-keys" title="Permalink to this headline">¶</a></h3>
<p>开放云服务ACS保留的条件关键字命名格式为：</p>
<div class="highlight-python"><pre>acs:&lt;condition-key&gt;</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>condition-key: ACS保留了5种条件关键字，所有的开放服务可以共用。它们是：acs:CurrentTime, acs:SecureTransport, acs:SourceIp, acs:UserAgent, acs:Referer。</li>
</ul>
</div>
<p>具体服务相关的条件关键字的命名格式为：</p>
<div class="highlight-python"><pre>&lt;service-name&gt;:&lt;condition-key&gt;</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>condition-key: service自定义的条件关键字。</li>
</ul>
</div>
</div>
<div class="section" id="id11">
<h3>访问策略样例<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>Policy Sample:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="o">{</span>
<span class="s">&quot;Version&quot;</span><span class="o">:</span> <span class="s">&quot;1&quot;</span><span class="o">,</span>
<span class="s">&quot;Statement&quot;</span><span class="o">:</span>
 <span class="o">[{</span>
    <span class="s">&quot;Effect&quot;</span><span class="o">:</span><span class="s">&quot;Allow&quot;</span><span class="o">,</span>
    <span class="s">&quot;Principal&quot;</span><span class="o">:</span><span class="s">&quot;ALIYUN$alice@aliyun.com&quot;</span><span class="o">,</span>
    <span class="s">&quot;Action&quot;</span><span class="o">:[</span><span class="s">&quot;odps:CreateTable&quot;</span><span class="o">,</span><span class="s">&quot;odps:CreateInstance&quot;</span><span class="o">,</span><span class="s">&quot;odps:List&quot;</span><span class="o">],</span>
    <span class="s">&quot;Resource&quot;</span><span class="o">:</span><span class="s">&quot;acs:odps:*:projects/prj1&quot;</span><span class="o">,</span>
    <span class="s">&quot;Condition&quot;</span><span class="o">:{</span>
        <span class="s">&quot;DateLessThan&quot;</span><span class="o">:</span> <span class="o">{</span>
            <span class="s">&quot;acs:CurrentTime&quot;</span><span class="o">:</span><span class="s">&quot;2013-11-11T23:59:59Z&quot;</span>
        <span class="o">},</span>
        <span class="s">&quot;IpAddress&quot;</span><span class="o">:</span> <span class="o">{</span>
            <span class="s">&quot;acs:SourceIp&quot;</span><span class="o">:</span><span class="s">&quot;10.32.180.0/23&quot;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">},</span>
<span class="o">{</span>
    <span class="s">&quot;Effect&quot;</span><span class="o">:</span><span class="s">&quot;Deny&quot;</span><span class="o">,</span>
    <span class="s">&quot;Principal&quot;</span><span class="o">:</span><span class="s">&quot;ALIYUN$alice@aliyun.com&quot;</span><span class="o">,</span>
    <span class="s">&quot;Action&quot;</span><span class="o">:</span><span class="s">&quot;odps:Drop&quot;</span><span class="o">,</span>
    <span class="s">&quot;Resource&quot;</span><span class="o">:</span><span class="s">&quot;acs:odps:*:projects/prj1/tables/*&quot;</span>
<span class="o">}]</span>
<span class="o">}</span>
</pre></div>
</div>
<p>解释：授权用户alice&#64;aliyun.com只能在&#8221;2013-11-11T23:59:59Z&#8221;这个时间点之前、只能从&#8221;10.32.180.0/23&#8221;这个IP段提交请求，只允许在项目空间prj1中执行CreateInstance, CreateTable和 List操作，禁止删除prj1下的任何table。</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">访问策略语言</a><ul>
<li><a class="reference internal" href="#id2">基本术语</a><ul>
<li><a class="reference internal" href="#principal">主体(Principal)</a></li>
<li><a class="reference internal" href="#action">操作(Action)</a></li>
<li><a class="reference internal" href="#resource">资源(Resource)</a></li>
<li><a class="reference internal" href="#access-restriction">访问限制(Access Restriction)</a></li>
<li><a class="reference internal" href="#effect">效力(Effect)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id3">访问策略语言结构</a><ul>
<li><a class="reference internal" href="#statement">授权语句(Statement)结构</a></li>
<li><a class="reference internal" href="#odps-sec-accesspolicy-condition">条件块结构</a></li>
<li><a class="reference internal" href="#id5">条件操作类型</a></li>
<li><a class="reference internal" href="#id6">条件关键字</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id7">访问策略语言规范</a><ul>
<li><a class="reference internal" href="#id8">Principal命名规范</a></li>
<li><a class="reference internal" href="#id9">Resource命名规范</a></li>
<li><a class="reference internal" href="#id10">Action命名规范</a></li>
<li><a class="reference internal" href="#condition-keys">Condition Keys命名规范</a></li>
<li><a class="reference internal" href="#id11">访问策略样例</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../odps_tools/index.html" title="ODPS工具手册"
             >next</a></li>
        <li class="right" >
          <a href="odps_sec_cmdlist.html" title="ODPS安全相关语句汇总"
             >previous</a> |</li>
        <li><a href="../../index.html">ODPS 1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >ODPS 安全参考手册</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright Alibaba 2014-07-01.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2b1.
    </div>
  <!-- 请把脚本放到 body 元素内 -->
  </body>
</html>