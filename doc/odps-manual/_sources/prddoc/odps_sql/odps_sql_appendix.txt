附录
------------------
在ODPS SQL中的字符串常量可以用单引号或双引号表示，可以在单引号括起的字符串中包含双引号，或在双引号括起的字符串中包含单引号，否则要用转义符来表达，如以下表达方式都是可以的

::

 "I'm a happy manong!"
 'I\'m a happy manong!'

在ODPS SQL中反斜线"\\"是转义符，用来表达字符串中的特殊字符，或将其后跟的字符解释为其本身。当读入字符串常量时，如果反斜线后跟三位有效的8进制数字，范围在\001 ~\177之间，系统会根据ASCII值转为相应的字符。对于以下情况，则会将其解释为特殊字符：

+----------+-----------------+
| 转义     | 字符            |
+==========+=================+
| \\b      | backspace       |
+----------+-----------------+
| \\t      | tab             | 
+----------+-----------------+
| \\n      | newline         |
+----------+-----------------+
| \\r      | carriage-return |
+----------+-----------------+
| \\'      | 单引号          |
+----------+-----------------+
| \\"      | 双引号          |
+----------+-----------------+
| \\ \\    | 反斜线          |
+----------+-----------------+
| \\;      | 分号            |
+----------+-----------------+
| \\Z      | control-Z       |
+----------+-----------------+
| \\0或\\00| 结束符          |
+----------+-----------------+
 
.. code-block:: sql

 select length('a\tb') from dual; 

结果是3，表示字符串里实际有三个字符,"\\t"被视为一个字符。在转义符后的其它字符被解释为其本身。

.. code-block:: sql

 select 'a\ab',length('a\ab') from dual;

结果是'aab', 3。"\\a"被解释成了普通的"a"。

LIKE字符匹配
`````````````
在LIKE匹配时，"%"表示匹配任意多个字符，"_"表示匹配单个字符，如果要匹配"%"或"_"本身，则要对其进行转义, "\\\\%"匹配字符"%"， "\\\\_"匹配字符"_"。

::

 'abcd' like 'ab%' -- true
 'abcd' like 'ab\%' -- false
 'ab%cd' like 'ab\\%%' -- true

.. Note:: 关于字符串的字符集，目前ODPS SQL支持UTF-8的字符集，如果数据是以其它格式编码，可能计算出的结果不正确。

正则表达式规范
````````````````
ODPS SQL中的正则表达式采用的是PCRE的规范，匹配时是按字符进行，支持的元字符如下：

+-----------+-----------------------------------------------------+
| 元字符    | 说明                                                |
+===========+=====================================================+
| ^         | 行首                                                |
+-----------+-----------------------------------------------------+
| $         | 行尾                                                |
+-----------+-----------------------------------------------------+
| .         | 任意字符                                            |
+-----------+-----------------------------------------------------+
| \*        | 匹配零次或多次                                      |
+-----------+-----------------------------------------------------+
| \+        | 匹配1次或多次                                       |
+-----------+-----------------------------------------------------+
| ?         | 匹配零次或1次                                       |
+-----------+-----------------------------------------------------+
| ?         | 匹配修饰符，当该字符紧跟在任何一个其他限制符        |
|           | (* ,+, ?, {n}, {n,}, {n,m})后面时，匹配模式是非贪   |
|           | 婪的。非贪婪模式尽可能少的匹配所搜索的字符串，      |
|           | 而默认的贪婪模式则尽可能多的匹配所搜索的字符串。    |
+-----------+-----------------------------------------------------+
| A|B       | A或B                                                |
+-----------+-----------------------------------------------------+
| (abc)*    | 匹配abc序列零次或多次                               |
+-----------+-----------------------------------------------------+
| {n}或{m,n}| 匹配的次数                                          |
+-----------+-----------------------------------------------------+
| [ab]      | 匹配括号中的任一字符,例中模式匹配a或b               |
+-----------+-----------------------------------------------------+
| [a-d]     | 匹配a,b,c,d任一字符                                 |
+-----------+-----------------------------------------------------+
| [^ab]     | ^表示非，匹配任一非a非 b的字符                      |
+-----------+-----------------------------------------------------+
| [::]      | 见下表POSIX字符组                                   |
+-----------+-----------------------------------------------------+
| \\        | 转义符                                              |
+-----------+-----------------------------------------------------+
| \\n       | n为数字1-9，后向引用                                |
+-----------+-----------------------------------------------------+
| \\d       | 数字                                                |
+-----------+-----------------------------------------------------+
| \\D       | 非数字                                              |
+-----------+-----------------------------------------------------+

POSIX字符组

+-------------+--------------------+----------------------------------+
| POSIX字符组 |     说明           | 范围                             |
+=============+====================+==================================+
| [[:alnum:]] | 字母字符和数字字符 | [a-zA-Z0-9]                      |
+-------------+--------------------+----------------------------------+
| [[:alpha:]] | 字母               | [a-zA-Z]                         |
+-------------+--------------------+----------------------------------+
| [[:ascii:]] | ASCII字符          | [\\x00-\\x7F]                    |
+-------------+--------------------+----------------------------------+
| [[:blank:]] | 空格字符和制表符   | [ \\t]                           |
+-------------+--------------------+----------------------------------+
| [[:cntrl:]] | 控制字符           | [\\x00-\\x1F\\x7F]               |
+-------------+--------------------+----------------------------------+
| [[:digit:]] | 数字字符           | [0-9]                            |
+-------------+--------------------+----------------------------------+
| [[:graph:]] | 空白字符之外的字符 | [\\x21-\\x7E]                    |
+-------------+--------------------+----------------------------------+
| [[:lower:]] | 小写字母字符       | [a-z]                            |
+-------------+--------------------+----------------------------------+
| [[:print:]] | [:graph:]和空白字符| [\\x20-\\x7E]                    |
+-------------+--------------------+----------------------------------+
| [[:punct:]] | 标点符号           | [][!"#$%&'()*+,./:;<=>?          |
|             |                    | @\\^_`{\|}~-]                    |  
+-------------+--------------------+----------------------------------+
| [[:space:]] | 空白字符           | [ \\t\\r\\n\\v\\f]               |
+-------------+--------------------+----------------------------------+
| [[:upper:]] | 大写字母字符       | [A-Z]                            |
+-------------+--------------------+----------------------------------+
| [[:xdigit:]]| 十六进制字符       | [A-Fa-f0-9]                      |
+-----------+----------------------+----------------------------------+

由于系统采用反斜线"\\"作为转义符，因此正则表达式的模式中出现的"\\"都要进行二次转义。如正则表达式要匹配字符串"a+b"，其中"+"是正则中的一个特殊字符，因此要用转义的方式表达，在正则引擎中的表达方式是"a\\+b"，由于系统还要解释一层转义，因此能够匹配该字符串的表达式是"a\\\\+b"。例如，假设存在表test_dual，

::

 select 'a+b' rlike 'a\\+b' from test_dual;

 +------+
 | _c1  |
 +------+
 | true |
 +------+

极端的情况，如果在要匹配字符"\\"， 由于在正则引擎中"\\"是一个特殊字符，因此要表示为"\\\\"，而系统还要对表达式进行一次转义，因此写成"\\\\\\\\"

::

 select 'a\\b', 'a\\b' rlike 'a\\\\b' from test_dual;

 +-----+------+
 | _c0 | _c1  |
 +-----+------+
 | a\b | true |
 +-----+------+

.. note:: 在ODPS SQL中写"a\\\\b"， 而在输出结果中显示'a\\b'，同样是因为ODPS会对表达式进行转意。

如果字符串中有制表符TAB, 系统在读入'\\t'这两个字符的时候，即已经将其存为一个字符，因此在正则的模式中也是一个普通的字符。

::

 select 'a\tb', 'a\tb' rlike 'a\tb' from test_dual;

 +---------+------+
 | _c0     | _c1  |
 +---------+------+
 | a     b | true |
 +---------+------+


.. _odps_keyword:

ODPS SQL保留字
````````````````

以下ODPS SQL的全部保留字，在对表、列或是分区命名时请不要使用，否则会报错。保留字不区分大小写。

+--------------+-------------+-------------+----------------+------------+--------------------+--------------+
|             %|            &|           &&|               (|           )|                  \*|            \+|
+--------------+-------------+-------------+----------------+------------+--------------------+--------------+
|            \-|            .|            /|               ;|          < |                  <=|           <> |
+--------------+-------------+-------------+----------------+------------+--------------------+--------------+
|             =|           > |           >=|               ?|         ADD|               AFTER|           ALL|
+--------------+-------------+-------------+----------------+------------+--------------------+--------------+
|         ALTER|      ANALYZE|          AND|         ARCHIVE|       ARRAY|                  AS|           ASC|
+--------------+-------------+-------------+----------------+------------+--------------------+--------------+
|        BEFORE|      BETWEEN|       BIGINT|          BINARY|        BLOB|             BOOLEAN|          BOTH|
+--------------+-------------+-------------+----------------+------------+--------------------+--------------+
|        BUCKET|      BUCKETS|           BY|         CASCADE|        CASE|                CAST|         CFILE|
+--------------+-------------+-------------+----------------+------------+--------------------+--------------+
|        CHANGE|      CLUSTER|    CLUSTERED|   CLUSTERSTATUS|  COLLECTION|              COLUMN|       COLUMNS|
+--------------+-------------+-------------+----------------+------------+--------------------+--------------+
|       COMMENT|      COMPUTE|  CONCATENATE|        CONTINUE|      CREATE|               CROSS|       CURRENT|
+--------------+-------------+-------------+----------------+------------+--------------------+--------------+
|        CURSOR|         DATA|     DATABASE|       DATABASES|        DATE|            DATETIME|  DBPROPERTIES|
+--------------+-------------+-------------+----------------+------------+--------------------+--------------+
|      DEFERRED|       DELETE|    DELIMITED|            DESC|    DESCRIBE|           DIRECTORY|       DISABLE|
+--------------+-------------+-------------+----------------+------------+--------------------+--------------+
|      DISTINCT|   DISTRIBUTE|       DOUBLE|            DROP|        ELSE|              ENABLE|           END|
+--------------+-------------+-------------+----------------+------------+--------------------+--------------+
|       ESCAPED|    EXCLUSIVE|       EXISTS|         EXPLAIN|      EXPORT|            EXTENDED|      EXTERNAL|
+--------------+-------------+-------------+----------------+------------+--------------------+--------------+
|         FALSE|        FETCH|       FIELDS|      FILEFORMAT|       FIRST|               FLOAT|     FOLLOWING|
+--------------+-------------+-------------+----------------+------------+--------------------+--------------+
|        FORMAT|    FORMATTED|         FROM|            FULL|    FUNCTION|           FUNCTIONS|         GRANT|
+--------------+-------------+-------------+----------------+------------+--------------------+--------------+
|         GROUP|       HAVING| HOLD_DDLTIME|   IDXPROPERTIES|          IF|              IMPORT|            IN|
+--------------+-------------+-------------+----------------+------------+--------------------+--------------+
|         INDEX|      INDEXES|       INPATH|     INPUTDRIVER| INPUTFORMAT|              INSERT|           INT|
+--------------+-------------+-------------+----------------+------------+--------------------+--------------+
|     INTERSECT|         INTO|           IS|           ITEMS|        JOIN|                KEYS|       LATERAL|
+--------------+-------------+-------------+----------------+------------+--------------------+--------------+
|          LEFT|    LIFECYCLE|         LIKE|           LIMIT|       LINES|                LOAD|         LOCAL|
+--------------+-------------+-------------+----------------+------------+--------------------+--------------+
|      LOCATION|         LOCK|        LOCKS|            LONG|         MAP|             MAPJOIN|  MATERIALIZED|
+--------------+-------------+-------------+----------------+------------+--------------------+--------------+
|         MINUS|         MSCK|          NOT|         NO_DROP|        NULL|                  OF|       OFFLINE|
+--------------+-------------+-------------+----------------+------------+--------------------+--------------+
|            ON|       OPTION|           OR|           ORDER|         OUT|               OUTER|  OUTPUTDRIVER|
+--------------+-------------+-------------+----------------+------------+--------------------+--------------+
|  OUTPUTFORMAT|         OVER|    OVERWRITE|       PARTITION| PARTITIONED| PARTITIONPROPERTIES|    PARTITIONS|
+--------------+-------------+-------------+----------------+------------+--------------------+--------------+
|       PERCENT|         PLUS|    PRECEDING|        PRESERVE|   PROCEDURE|               PURGE|         RANGE|
+--------------+-------------+-------------+----------------+------------+--------------------+--------------+
|        RCFILE|         READ|     READONLY|           READS|     REBUILD|        RECORDREADER|  RECORDWRITER|
+--------------+-------------+-------------+----------------+------------+--------------------+--------------+
|        REDUCE|       REGEXP|       RENAME|          REPAIR|     REPLACE|            RESTRICT|        REVOKE|
+--------------+-------------+-------------+----------------+------------+--------------------+--------------+
|         RIGHT|        RLIKE|          ROW|            ROWS|      SCHEMA|             SCHEMAS|        SELECT|
+--------------+-------------+-------------+----------------+------------+--------------------+--------------+
|          SEMI| SEQUENCEFILE|        SERDE| SERDEPROPERTIES|         SET|              SHARED|          SHOW|
+--------------+-------------+-------------+----------------+------------+--------------------+--------------+
| SHOW_DATABASE|     SMALLINT|         SORT|          SORTED|         SSL|          STATISTICS|        STORED|
+--------------+-------------+-------------+----------------+------------+--------------------+--------------+
|   STREAMTABLE|       STRING|       STRUCT|           TABLE|      TABLES|         TABLESAMPLE| TBLPROPERTIES|
+--------------+-------------+-------------+----------------+------------+--------------------+--------------+
|     TEMPORARY|   TERMINATED|     TEXTFILE|            THEN|   TIMESTAMP|             TINYINT|            TO|
+--------------+-------------+-------------+----------------+------------+--------------------+--------------+
|         TOUCH|    TRANSFORM|      TRIGGER|            TRUE|   UNARCHIVE|           UNBOUNDED|          UNDO|
+--------------+-------------+-------------+----------------+------------+--------------------+--------------+
|         UNION|    UNIONTYPE|   UNIQUEJOIN|          UNLOCK|    UNSIGNED|              UPDATE|           USE|
+--------------+-------------+-------------+----------------+------------+--------------------+--------------+
|         USING|          UTC| UTC_TMESTAMP|            VIEW|        WHEN|               WHERE|         WHILE|
+--------------+-------------+-------------+----------------+------------+--------------------+--------------+

